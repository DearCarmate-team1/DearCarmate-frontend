# Dear Carmate Backend - 구현 계획서

## 📋 개발 로드맵

이 문서는 Dear Carmate 백엔드 개발의 단계별 구현 계획을 제시합니다.

---

## 🎯 Phase 1: 프로젝트 기반 구축 (1-2주)

### **1.1 프로젝트 초기 설정**
- [ ] Node.js + TypeScript 프로젝트 초기화
- [ ] 필수 패키지 설치 및 설정
- [ ] ESLint, Prettier 코드 품질 도구 설정
- [ ] 폴더 구조 생성 (Layered Architecture)
- [ ] 환경변수 설정 (.env 파일)

### **1.2 데이터베이스 설정**
- [ ] PostgreSQL 데이터베이스 생성
- [ ] Prisma 초기 설정 및 스키마 작성
- [ ] 기본 마이그레이션 실행
- [ ] 데이터베이스 연결 테스트

### **1.3 기본 서버 구조**
- [ ] Express 서버 기본 설정
- [ ] 미들웨어 설정 (CORS, Helmet, Morgan)
- [ ] 에러 핸들링 미들웨어
- [ ] 기본 라우터 구조 생성
- [ ] 헬스체크 엔드포인트

### **1.4 개발 환경 구축**
- [ ] Nodemon 설정으로 개발 서버 자동 재시작
- [ ] Docker 및 Docker Compose 설정
- [ ] 테스트 환경 설정 (Jest + Supertest)
- [ ] CI/CD 기본 파이프라인 설정

**예상 완료: 1-2주**

---

## 🔐 Phase 2: 인증 시스템 구축 (1주)

### **2.1 JWT 인증 시스템**
- [ ] JWT 토큰 생성/검증 유틸리티
- [ ] Access Token + Refresh Token 구조
- [ ] 쿠키 기반 토큰 저장 로직
- [ ] 토큰 자동 갱신 미들웨어

### **2.2 비밀번호 보안**
- [ ] bcrypt 해싱 유틸리티
- [ ] 비밀번호 강도 검증
- [ ] 비밀번호 변경 로직

### **2.3 인증 미들웨어**
- [ ] JWT 토큰 검증 미들웨어
- [ ] 사용자 권한 검증 (Admin/User)
- [ ] Multi-tenant 데이터 격리 미들웨어

### **2.4 기본 인증 API**
- [ ] POST /auth/login - 로그인
- [ ] POST /auth/refresh - 토큰 갱신
- [ ] 인증 관련 단위 테스트

**예상 완료: 1주**

---

## 👥 Phase 3: 사용자 및 회사 관리 (1-2주)

### **3.1 회사 관리 시스템**
- [ ] Company 모델 및 Repository
- [ ] Company Service 비즈니스 로직
- [ ] Company Controller 및 라우터
- [ ] 회사 등록/수정/삭제/조회 API

### **3.2 사용자 관리 시스템**
- [ ] User 모델 및 Repository
- [ ] User Service 비즈니스 로직  
- [ ] User Controller 및 라우터
- [ ] 회원가입/정보수정/탈퇴 API

### **3.3 권한 관리**
- [ ] 관리자 권한 검증 로직
- [ ] 회사별 사용자 접근 제어
- [ ] 사용자 정보 보안 필터링

### **3.4 완성된 API 목록**
- [ ] POST /users - 회원가입
- [ ] GET /users/me - 내 정보 조회
- [ ] PATCH /users/me - 내 정보 수정
- [ ] DELETE /users/me - 회원 탈퇴
- [ ] DELETE /users/{userId} - 유저 삭제 (관리자)
- [ ] POST /companies - 회사 등록
- [ ] GET /companies - 회사 목록 조회
- [ ] PATCH /companies/{companyId} - 회사 수정
- [ ] DELETE /companies/{companyId} - 회사 삭제
- [ ] GET /companies/users - 회사별 유저 조회

**예상 완료: 1-2주**

---

## 🚗 Phase 4: 차량 관리 시스템 (1-2주)

### **4.1 차량 기본 CRUD**
- [ ] Car 모델 및 Repository
- [ ] Car Service 비즈니스 로직
- [ ] Car Controller 및 라우터
- [ ] 차량 등록/수정/삭제/조회 API

### **4.2 차량 목록 및 검색**
- [ ] 페이지네이션 구현
- [ ] 검색 기능 (차량번호, 차종)
- [ ] 상태별 필터링 로직
- [ ] 정렬 기능 구현

### **4.3 차량 모델 마스터 데이터**
- [ ] CarModel 시드 데이터 생성
- [ ] 제조사별 모델 조회 API
- [ ] 차량 등록 시 모델 검증

### **4.4 대용량 업로드**
- [ ] CSV 파일 파싱 로직
- [ ] 트랜잭션 기반 일괄 등록
- [ ] 업로드 결과 리포트 생성
- [ ] 오류 처리 및 롤백

### **4.5 완성된 API 목록**
- [ ] POST /cars - 차량 등록
- [ ] GET /cars - 차량 목록 조회
- [ ] GET /cars/{carId} - 차량 상세 조회
- [ ] PATCH /cars/{carId} - 차량 수정
- [ ] DELETE /cars/{carId} - 차량 삭제
- [ ] GET /cars/models - 차량 모델 목록
- [ ] POST /cars/upload - 차량 대용량 업로드

**예상 완료: 1-2주**

---

## 👤 Phase 5: 고객 관리 시스템 (1주)

### **5.1 고객 기본 CRUD**
- [ ] Customer 모델 및 Repository
- [ ] Customer Service 비즈니스 로직
- [ ] Customer Controller 및 라우터
- [ ] 고객 등록/수정/삭제/조회 API

### **5.2 고객 목록 및 검색**
- [ ] 페이지네이션 구현
- [ ] 검색 기능 (고객명, 이메일)
- [ ] 고객 정보 표시 최적화

### **5.3 고객 대용량 업로드**
- [ ] CSV 파일 파싱 (고객 데이터)
- [ ] 트랜잭션 기반 일괄 등록
- [ ] 열거형 데이터 검증 (성별, 연령대, 지역)

### **5.4 완성된 API 목록**
- [ ] POST /customers - 고객 등록
- [ ] GET /customers - 고객 목록 조회
- [ ] GET /customers/{customerId} - 고객 상세 조회
- [ ] PATCH /customers/{customerId} - 고객 수정
- [ ] DELETE /customers/{customerId} - 고객 삭제
- [ ] POST /customers/upload - 고객 대용량 업로드

**예상 완료: 1주**

---

## 📄 Phase 6: 계약 관리 시스템 (2-3주)

### **6.1 계약 기본 모델**
- [ ] Contract 모델 및 Repository
- [ ] 계약 상태 워크플로우 정의
- [ ] 미팅 스케줄 JSON 구조 설계
- [ ] 계약-차량-고객-사용자 관계 설정

### **6.2 계약 CRUD API**
- [ ] Contract Service 비즈니스 로직
- [ ] Contract Controller 및 라우터
- [ ] 계약 등록/수정/삭제 API
- [ ] 계약 상태 변경 로직

### **6.3 계약 보드 (칸반)**
- [ ] 상태별 계약 그룹화 로직
- [ ] 드래그 앤 드롭을 위한 상태 변경 API
- [ ] 실시간 업데이트 대응
- [ ] 검색 기능 (고객명, 담당자명)

### **6.4 미팅 관리**
- [ ] 미팅 스케줄 CRUD
- [ ] 알림 시간 설정 로직
- [ ] 미팅 일정 검증

### **6.5 완성된 API 목록**
- [ ] POST /contracts - 계약 등록
- [ ] GET /contracts - 계약 목록 조회 (칸반)
- [ ] PATCH /contracts/{contractId} - 계약 수정
- [ ] DELETE /contracts/{contractId} - 계약 삭제
- [ ] GET /contracts/cars - 계약용 차량 목록
- [ ] GET /contracts/customers - 계약용 고객 목록
- [ ] GET /contracts/users - 계약용 사용자 목록

**예상 완료: 2-3주**

---

## 📁 Phase 7: 파일 및 문서 관리 (1-2주)

### **7.1 파일 업로드 기반 구조**
- [ ] Multer 미들웨어 설정
- [ ] 파일 저장 경로 관리
- [ ] 파일 크기 및 형식 검증
- [ ] 파일 메타데이터 저장

### **7.2 이미지 처리**
- [ ] 이미지 리사이징 (Sharp)
- [ ] 이미지 최적화 및 압축
- [ ] 썸네일 생성
- [ ] 이미지 URL 반환 API

### **7.3 계약서 문서 관리**
- [ ] ContractDocument 모델 및 Repository
- [ ] 문서 업로드/다운로드 API
- [ ] 문서 목록 조회 및 검색
- [ ] 초안 문서 관리

### **7.4 완성된 API 목록**
- [ ] POST /images/upload - 이미지 업로드
- [ ] POST /contractDocuments/upload - 계약서 업로드
- [ ] GET /contractDocuments - 계약서 목록 조회
- [ ] GET /contractDocuments/draft - 초안 목록
- [ ] GET /contractDocuments/{documentId}/download - 문서 다운로드

**예상 완료: 1-2주**

---

## 📊 Phase 8: 대시보드 및 통계 (1주)

### **8.1 통계 데이터 집계**
- [ ] 월별 매출 계산 로직
- [ ] 성장률 계산 알고리즘
- [ ] 계약 현황 집계
- [ ] 차량 타입별 분석

### **8.2 대시보드 API**
- [ ] Dashboard Service 구현
- [ ] 실시간 데이터 집계
- [ ] 캐싱 전략 적용
- [ ] 성능 최적화

### **8.3 완성된 API**
- [ ] GET /dashboard - 통계 조회

**예상 완료: 1주**

---

## 📧 Phase 9: 알림 시스템 (1-2주)

### **9.1 이메일 시스템 구축**
- [ ] Nodemailer 설정
- [ ] 이메일 템플릿 엔진 (Handlebars)
- [ ] SMTP 서버 연동
- [ ] 이메일 발송 큐 시스템

### **9.2 알림 관리**
- [ ] Notification 모델 설계
- [ ] 알림 스케줄링 로직
- [ ] 템플릿 변수 치환
- [ ] 발송 결과 추적

### **9.3 미팅 리마인더**
- [ ] 자동 알림 발송 로직
- [ ] 알림 시간 계산
- [ ] 재발송 메커니즘

### **9.4 계약서 업로드 알림**
- [ ] 계약서 업로드 시 자동 이메일
- [ ] 고객 정보 기반 수신자 설정
- [ ] 첨부파일 처리

**예상 완료: 1-2주**

---

## 🧪 Phase 10: 테스트 및 최적화 (1-2주)

### **10.1 단위 테스트**
- [ ] Service 계층 테스트 작성
- [ ] Repository 계층 테스트
- [ ] Utility 함수 테스트
- [ ] 테스트 커버리지 80% 달성

### **10.2 통합 테스트**
- [ ] API 엔드포인트 테스트
- [ ] 인증 플로우 테스트
- [ ] 파일 업로드 테스트
- [ ] 대용량 데이터 처리 테스트

### **10.3 성능 최적화**
- [ ] 데이터베이스 쿼리 최적화
- [ ] 인덱스 설정 및 튜닝
- [ ] API 응답 시간 개선
- [ ] 메모리 사용량 최적화

### **10.4 시드 데이터 생성**
- [ ] 기본 회사 데이터 생성
- [ ] 테스트 사용자 계정 생성
- [ ] 샘플 차량/고객/계약 데이터
- [ ] 차량 모델 마스터 데이터

**예상 완료: 1-2주**

---

## 🚀 Phase 11: 배포 및 운영 (1주)

### **11.1 프로덕션 설정**
- [ ] 환경별 설정 분리
- [ ] Docker 프로덕션 이미지
- [ ] 로깅 및 모니터링 설정
- [ ] 보안 설정 강화

### **11.2 CI/CD 파이프라인**
- [ ] GitHub Actions 설정
- [ ] 자동 테스트 실행
- [ ] 자동 배포 스크립트
- [ ] 롤백 메커니즘

### **11.3 문서화**
- [ ] API 문서 자동 생성 (Swagger)
- [ ] 배포 가이드 작성
- [ ] 운영 매뉴얼 작성
- [ ] 트러블슈팅 가이드

**예상 완료: 1주**

---

## 📅 전체 일정 요약

| Phase | 기능 | 예상 기간 | 누적 기간 |
|-------|------|----------|-----------|
| Phase 1 | 프로젝트 기반 구축 | 1-2주 | 1-2주 |
| Phase 2 | 인증 시스템 | 1주 | 2-3주 |
| Phase 3 | 사용자/회사 관리 | 1-2주 | 3-5주 |
| Phase 4 | 차량 관리 | 1-2주 | 4-7주 |
| Phase 5 | 고객 관리 | 1주 | 5-8주 |
| Phase 6 | 계약 관리 | 2-3주 | 7-11주 |
| Phase 7 | 파일/문서 관리 | 1-2주 | 8-13주 |
| Phase 8 | 대시보드/통계 | 1주 | 9-14주 |
| Phase 9 | 알림 시스템 | 1-2주 | 10-16주 |
| Phase 10 | 테스트/최적화 | 1-2주 | 11-18주 |
| Phase 11 | 배포/운영 | 1주 | 12-19주 |

**총 예상 기간: 12-19주 (약 3-5개월)**

---

## 🎯 주요 마일스톤

### **Milestone 1: MVP 완성 (6-8주)**
- 기본 인증 시스템
- 사용자/회사/차량/고객 CRUD
- 기본 계약 관리

### **Milestone 2: 핵심 기능 완성 (10-14주)**
- 계약 워크플로우 완성
- 파일 업로드 시스템
- 대시보드 통계

### **Milestone 3: 프로덕션 준비 (12-19주)**
- 알림 시스템 완성
- 테스트 커버리지 달성
- 배포 및 운영 준비

---

## 🔧 개발 우선순위 가이드

### **High Priority (필수 기능)**
1. 인증 및 권한 관리
2. Multi-tenant 데이터 격리
3. 기본 CRUD 기능 (사용자, 회사, 차량, 고객)
4. 계약 워크플로우
5. 파일 업로드 기본 기능

### **Medium Priority (핵심 기능)**
1. 대용량 업로드 (CSV)
2. 대시보드 통계
3. 계약서 문서 관리
4. 검색 및 필터링
5. 페이지네이션

### **Low Priority (부가 기능)**
1. 이메일 알림 시스템
2. 고급 통계 분석
3. 이미지 최적화
4. 성능 최적화
5. 고급 로깅/모니터링

이 구현 계획서를 바탕으로 체계적이고 단계적인 개발을 진행할 수 있습니다.